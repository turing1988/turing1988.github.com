<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Sqlite问题小结 | Nankor Dream</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="最近为了学习用了一下sqlite，开始就碰上了最棘手的问题，乱码、版本不兼容等。查了些资料，自己终于想办法解决了。">
<meta name="keywords" content="乱码,sqlite,utf8">
<meta property="og:type" content="article">
<meta property="og:title" content="Sqlite问题小结">
<meta property="og:url" content="http://nankor.org/Program/03/21/sqlite-problem-summary.html">
<meta property="og:site_name" content="Nankor Dream">
<meta property="og:description" content="最近为了学习用了一下sqlite，开始就碰上了最棘手的问题，乱码、版本不兼容等。查了些资料，自己终于想办法解决了。">
<meta property="og:image" content="http://nankor.org/uploads/2012/03/屏幕截图-2012年03月21日-00时41分21秒.png">
<meta property="og:updated_time" content="2017-06-18T15:27:08.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sqlite问题小结">
<meta name="twitter:description" content="最近为了学习用了一下sqlite，开始就碰上了最棘手的问题，乱码、版本不兼容等。查了些资料，自己终于想办法解决了。">
<meta name="twitter:image" content="http://nankor.org/uploads/2012/03/屏幕截图-2012年03月21日-00时41分21秒.png">
<meta name="twitter:creator" content="@Nan_Kor">
<link rel="publisher" href="南柯">
  
    <link rel="alternative" href="/atom.xml" title="Nankor Dream" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29624318-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Nankor Dream</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Nankor&#39;s Blog</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="http://nankor.org/wiki/wikihtml">Wiki</a>
        
          <a class="main-nav-link" href="/vim-and-vimrc">Vim</a>
        
          <a class="main-nav-link" href="/about_me">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://nankor.org"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-sqlite-problem-summary" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/Program/03/21/sqlite-problem-summary.html" class="article-date">
  <time datetime="2012-03-20T16:46:23.000Z" itemprop="datePublished">2012-03-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Program/">Program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Sqlite问题小结
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近为了学习用了一下sqlite，开始就碰上了最棘手的问题，乱码、版本不兼容等。查了些资料，自己终于想办法解决了。<a id="more"></a></p>
<p>之前没有接触过sqlite，只是知道在嵌入式方面用的颇广，这次也算学习一下。</p>
<h4 id="一、-版本兼容问题"><a href="#一、-版本兼容问题" class="headerlink" title="一、 版本兼容问题"></a>一、 版本兼容问题</h4><p>首先是版本兼容的问题，刚拿到的是个sqlite2数据库，而我的arch上都是sqlite3的各种包，sqlite3 pinyin.db自然失败。好吧，把sqlite2的各种包装上。</p>
<pre><code>sudo yaourt -Ss sqlite|grep installed
core/sqlite3 3.7.10-1 [installed]
core/sqlite3-doc 3.7.10-1 [installed]
community/gambas2-gb-db-sqlite2 2.23.1-8 (gambas2) [installed]
community/gambas3-gb-db-sqlite2 3.0.0-5 (gambas3) [installed]
community/libgda3 3.1.5-11 [installed]
community/sqlite2 2.8.17-5 [installed]
community/sqlitebrowser 2.0b1-2 [installed]
community/sqliteman 1.2.2-5 [installed]
community/sqlitemanager 1.2.4-2 [installed]
</code></pre><p>好了 尝试打开数据库：</p>
<pre><code>sqlite pinyin.db
SQLite version 2.8.17
Enter &quot;.help&quot; for instructions
sqlite&gt; .tables
acs_active        firereport        lapes_list        netconfig
acs_key_active    firereport_his    list_dev          pinyin
acssub            floor             logic_detail      sys
carddev           gz_type           logic_fixtimerun  timelist
cardmain          gz_view           logic_list        userinfo
devname           id100             logic_main        usertip
devtype           language          logic_out
sqlite&gt;
</code></pre><p>OK，顺利打开。</p>
<p>不过我想采用GUI的方式查看数据库，我已经安装了sqliteman与sqlitebroswer，但是他们全是支持sqlite3的，好吧，需要把sqlite2的数据库转化为sqlite3的。</p>
<p>sqlite有个.dump命令，十分好用，先看下帮助：</p>
<pre><code>sqlite
SQLite version 2.8.17
Enter &quot;.help&quot; for instructions
sqlite&gt; .help
.databases             List names and files of attached databases
.dump ?TABLE? ...      Dump the database in a text format
.echo ON|OFF           Turn command echo on or off
.exit                  Exit this program
.explain ON|OFF        Turn output mode suitable for EXPLAIN on or off.
.header(s) ON|OFF      Turn display of headers on or off
.help                  Show this message
.indices TABLE         Show names of all indices on TABLE
.mode MODE             Set mode to one of &quot;line(s)&quot;, &quot;column(s)&quot;,
                       &quot;insert&quot;, &quot;list&quot;, or &quot;html&quot;
.mode insert TABLE     Generate SQL insert statements for TABLE
.nullvalue STRING      Print STRING instead of nothing for NULL data
.output FILENAME       Send output to FILENAME
.output stdout         Send output to the screen
.prompt MAIN CONTINUE  Replace the standard prompts
.quit                  Exit this program
.read FILENAME         Execute SQL in FILENAME
.schema ?TABLE?        Show the CREATE statements
.separator STRING      Change separator string for &quot;list&quot; mode
.show                  Show the current values for various settings
.tables ?PATTERN?      List names of tables matching a pattern
.timeout MS            Try opening locked tables for MS milliseconds
.width NUM NUM ...     Set column widths for &quot;column&quot; mode
sqlite&gt;
</code></pre><p><strong>.dump 将数据库转换为文本格式保存，我理解是保存为sql，稍后会发现这个.dump确实太有用了。</strong></p>
<p>使用下面的命令实现sqlite2与sqlite3间的装换：</p>
<pre><code>sqlite pinyin.db .dump|sqlite3 pinyin.db3;file pinyin*
pinyin.db:  SQLite 2.x database
pinyin.db3: SQLite 3.x database
</code></pre><p>接下来使用sqliteman或者sqlitebroswer就能顺利打开pinyin.db3了。</p>
<h4 id="二、UTF-8与GBK间的乱码问题"><a href="#二、UTF-8与GBK间的乱码问题" class="headerlink" title="二、UTF-8与GBK间的乱码问题"></a>二、UTF-8与GBK间的乱码问题</h4><p>——————————————————————————————————————————————————</p>
<p>首先需要明确的是sqlite默认采用UTF-8编码；</p>
<p>Sqlite管理器类的工具不论平台当然使用的文本编码也是UTF8；</p>
<p>Windows中AAuto默认编码是ANSI(不是UTF8,而是GBK)；</p>
<p>windows下AAuto标准库里的sqlite库中的sqlite类对象会自动转换编码(UTF8-&gt;ANSI或ANSI-&gt;UTF8),使用UTF8编码写入sqlite数据库,再将读取的UTF8转换为ANSI编码.而直接用sqlite库的原始API,不会自动进行编码转换,需要自已调用string.fromto()函数转换.</p>
<p>在archlinux下xterm默认用的是UTF-8编码.</p>
<p>——————————————————————————————————————————————————</p>
<p>我数据库是从Windows平台下拷过来的，果不其然中间出现了乱码问题，必然需要转码了。</p>
<p>先看下原来的编码，pinyin.db是sqlie2数据库，pinyin.db3刚转化而来的sqlite3数据库</p>
<pre><code>enca pinyin*
pinyin.db: Simplified Chinese National Standard; GB2312
  Surrounded by/intermixed with non-text data
pinyin.db3: Unrecognized encoding
</code></pre><p>一个个text让应用去转码不可能，直接在数据库中转不具备可操作性，最后我想到了dump：</p>
<pre><code>sqlite3 pinyin.db3 .dump&gt;&gt;conv.txt;enca conv.txt
Simplified Chinese National Standard; GB2312
</code></pre><p>将数据库以文本格式保存，对文本进行转码，这个就多了，用iconv、enconv专门转码的也可以，用vim、gedit也行；我最终选择了vim，因为转起来方便。</p>
<p>vim conv.txt后，:set fileencoding=utf8，最后:wq保存退出就可以了。看下结果</p>
<pre><code>vim conv.txt




enca conv.txt
Universal transformation format 8 bits; UTF-8
  Surrounded by/intermixed with non-text data
</code></pre><p>好了，sql文本已经转换为UTF-8编码，这时候问题已经基本解决了。</p>
<p>最后重新生成sqlite3数据库即可：</p>
<pre><code>cat conv.txt|sqlite3 utf8pinyin.db3
</code></pre><p>好了，现在可以轻松使用sqliteman或者sqlitebroswer打开utf8pinyin.db3，没有乱码了。</p>
<p><a href="http://nankor.org/uploads/2012/03/屏幕截图-2012年03月21日-00时41分21秒.png"><img src="http://nankor.org/uploads/2012/03/屏幕截图-2012年03月21日-00时41分21秒.png" alt=""></a></p>
<p><strong>最后，我想团队开发一定要注意工作平台，另外尽量采用广泛支持的国际unicode编码。</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://nankor.org/Program/03/21/sqlite-problem-summary.html" data-id="cj42vagmw0016e9b2egcrdj8p" class="article-share-link">Share</a>
      
        <a href="http://nankor.org/Program/03/21/sqlite-problem-summary.html#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlite/">sqlite</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/utf8/">utf8</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/乱码/">乱码</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/Linux/03/23/the-of-of-of-synergy-sharing-tool-for-mouse-and-keyboard.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Synergy-共享鼠标与键盘的利器
        
      </div>
    </a>
  
  
    <a href="/Think/03/18/look-at-you-girl.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Look at you girl</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/Web/08/21/shanghai-web.html">魏武挥:从上海的互联网产业说开去</a>
          </li>
        
          <li>
            <a href="/Program/08/19/about-c++-smart-ptr.html">C++智能指针漫谈</a>
          </li>
        
          <li>
            <a href="/Program/08/18/avoid-inserting-blank-line-by-vim.html">关于Vim添加文件末尾空行</a>
          </li>
        
          <li>
            <a href="/Program/08/18/master-a-language.html">怎样才算会一门编程语言</a>
          </li>
        
          <li>
            <a href="/Linux/06/09/u-disk-only-read-filesystem.html">U盘只读文件系统</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Alogrithm/">Alogrithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Program/">Program</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Think/">Think</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Walk/">Walk</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/3D/" style="font-size: 10px;">3D</a> <a href="/tags/APJP/" style="font-size: 10px;">APJP</a> <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/Dota/" style="font-size: 10px;">Dota</a> <a href="/tags/Goagent/" style="font-size: 10px;">Goagent</a> <a href="/tags/HHKB/" style="font-size: 10px;">HHKB</a> <a href="/tags/IO-Stack/" style="font-size: 10px;">IO-Stack</a> <a href="/tags/IPV6/" style="font-size: 10px;">IPV6</a> <a href="/tags/Invictus/" style="font-size: 10px;">Invictus</a> <a href="/tags/Knproxy/" style="font-size: 10px;">Knproxy</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MS-office/" style="font-size: 10px;">MS-office</a> <a href="/tags/PDFXChange/" style="font-size: 10px;">PDFXChange</a> <a href="/tags/STL/" style="font-size: 10px;">STL</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/archlinux/" style="font-size: 20px;">archlinux</a> <a href="/tags/arm-linux/" style="font-size: 10px;">arm-linux</a> <a href="/tags/aur/" style="font-size: 10px;">aur</a> <a href="/tags/axel/" style="font-size: 10px;">axel</a> <a href="/tags/c/" style="font-size: 10px;">c++</a> <a href="/tags/fcitx/" style="font-size: 10px;">fcitx</a> <a href="/tags/gdb/" style="font-size: 10px;">gdb</a> <a href="/tags/girl/" style="font-size: 10px;">girl</a> <a href="/tags/google-redirect/" style="font-size: 10px;">google redirect</a> <a href="/tags/grep/" style="font-size: 10px;">grep</a> <a href="/tags/hack/" style="font-size: 10px;">hack</a> <a href="/tags/ixwebhosting/" style="font-size: 10px;">ixwebhosting</a> <a href="/tags/latex/" style="font-size: 10px;">latex</a> <a href="/tags/lingo/" style="font-size: 10px;">lingo</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/linux-matlab/" style="font-size: 10px;">linux matlab</a> <a href="/tags/lzw/" style="font-size: 10px;">lzw</a> <a href="/tags/mindmap/" style="font-size: 10px;">mindmap</a> <a href="/tags/music/" style="font-size: 10px;">music</a> <a href="/tags/packer/" style="font-size: 10px;">packer</a> <a href="/tags/pacman/" style="font-size: 10px;">pacman</a> <a href="/tags/php-ini/" style="font-size: 10px;">php.ini</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/sqlite/" style="font-size: 10px;">sqlite</a> <a href="/tags/svn/" style="font-size: 10px;">svn</a> <a href="/tags/synergy/" style="font-size: 10px;">synergy</a> <a href="/tags/trace/" style="font-size: 10px;">trace</a> <a href="/tags/trash/" style="font-size: 10px;">trash</a> <a href="/tags/ubuntu/" style="font-size: 20px;">ubuntu</a> <a href="/tags/upload/" style="font-size: 10px;">upload</a> <a href="/tags/utf8/" style="font-size: 10px;">utf8</a> <a href="/tags/vim/" style="font-size: 20px;">vim</a> <a href="/tags/wget/" style="font-size: 10px;">wget</a> <a href="/tags/wineqq/" style="font-size: 10px;">wineqq</a> <a href="/tags/wordpress/" style="font-size: 10px;">wordpress</a> <a href="/tags/yaourt/" style="font-size: 15px;">yaourt</a> <a href="/tags/上海/" style="font-size: 10px;">上海</a> <a href="/tags/乱码/" style="font-size: 15px;">乱码</a> <a href="/tags/互联网/" style="font-size: 10px;">互联网</a> <a href="/tags/别离/" style="font-size: 10px;">别离</a> <a href="/tags/博客/" style="font-size: 10px;">博客</a> <a href="/tags/压缩/" style="font-size: 10px;">压缩</a> <a href="/tags/启程/" style="font-size: 10px;">启程</a> <a href="/tags/大峪/" style="font-size: 10px;">大峪</a> <a href="/tags/字节对齐/" style="font-size: 10px;">字节对齐</a> <a href="/tags/宋朝/" style="font-size: 10px;">宋朝</a> <a href="/tags/开始/" style="font-size: 10px;">开始</a> <a href="/tags/思维发散/" style="font-size: 10px;">思维发散</a> <a href="/tags/思考/" style="font-size: 10px;">思考</a> <a href="/tags/成都/" style="font-size: 10px;">成都</a> <a href="/tags/数学/" style="font-size: 10px;">数学</a> <a href="/tags/曼德拉/" style="font-size: 10px;">曼德拉</a> <a href="/tags/朝花夕拾/" style="font-size: 10px;">朝花夕拾</a> <a href="/tags/杂/" style="font-size: 10px;">杂</a> <a href="/tags/清明上河园/" style="font-size: 10px;">清明上河园</a> <a href="/tags/编程效率/" style="font-size: 10px;">编程效率</a> <a href="/tags/老家/" style="font-size: 10px;">老家</a> <a href="/tags/自由/" style="font-size: 10px;">自由</a> <a href="/tags/英文自动输入/" style="font-size: 10px;">英文自动输入</a> <a href="/tags/英雄主义/" style="font-size: 10px;">英雄主义</a> <a href="/tags/虚拟光驱/" style="font-size: 10px;">虚拟光驱</a> <a href="/tags/虹鳟/" style="font-size: 10px;">虹鳟</a> <a href="/tags/软件设计/" style="font-size: 10px;">软件设计</a> <a href="/tags/追风筝的人/" style="font-size: 10px;">追风筝的人</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">17</span></li></ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 nankor<br>
      Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="http://nankor.org/wiki/wikihtml" class="mobile-nav-link">Wiki</a>
  
    <a href="/vim-and-vimrc" class="mobile-nav-link">Vim</a>
  
    <a href="/about_me" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'turing1988';
  
  var disqus_url = 'http://nankor.org/Program/03/21/sqlite-problem-summary.html';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
  </div>
</body>
</html>